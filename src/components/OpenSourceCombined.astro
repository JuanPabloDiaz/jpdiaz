---
import SubTitle from '@components/ui/SubTitle.astro';
import Link from '@components/ui/Link.astro';
import ProjectListSmall from '@components/projects/ProjectListSmall.astro';
import ContributionCard from '@components/contributions/ContributionCard.astro';
import { topContributions } from '@src/data/top-contributions';
import { processContributions } from '@utils/contributions';

// Process the contributions data and filter for homepage
const allProcessedContributions = processContributions(topContributions);
const processedContributions = allProcessedContributions.filter((contrib) => {
	// Find the original data to check the 'top' property
	const originalData = topContributions.find((original) => original.url === contrib.url);
	return originalData?.top === true;
});
---

<div class="h-10" id="oss"></div>

<section data-testid="openSource" class="mb-20 flex flex-col items-center justify-center md:mb-0">
	<SubTitle text="Open Source" />
	<p class="text-gray-500 mb-8 text-center lg:w-1/2">
		I love to contribute to OSS. Here are my top contributions and projects that I have worked on.
	</p>

	<!-- Top Contributions Section -->
	{
		processedContributions.length > 0 && (
			<div class="mb-16 w-full max-w-6xl">
				<h3 class="text-gray-800 dark:text-gray-200 mb-8 text-center text-2xl font-bold">
					🏆 Top Contributions
				</h3>
				<div class="flex flex-wrap justify-center">
					{processedContributions.map((contribution) => (
						<ContributionCard
							contribution={contribution}
							showDescription={true}
							isTopContribution={true}
						/>
					))}
				</div>
			</div>
		)
	}

	<!-- Open Source Projects Section -->
	<div class="w-full max-w-6xl">
		<h3 class="text-gray-800 dark:text-gray-200 mb-8 text-center text-2xl font-bold">
			🚀 Open Source Projects
		</h3>
		<ProjectListSmall collectionName="open-source" />
	</div>

	<div class="mt-8">
		<Link
			text="View all Open Source contributions"
			ariaLabel="View all Open Source contributions"
			href="./oss"
			arrow
		/>
	</div>
</section>
