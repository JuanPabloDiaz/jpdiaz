---
import type { ProcessedContribution } from '@utils/contributions.ts';
import Tags from '@components/ui/Tags.astro';

interface Props {
	contribution: ProcessedContribution;
	showDescription?: boolean;
	isTopContribution?: boolean;
}

const { contribution, showDescription = true, isTopContribution = false } = Astro.props;

function formatDate(dateString: string) {
	if (!dateString) return '';
	return new Date(dateString).toLocaleDateString('en-US', {
		year: 'numeric',
		month: 'short',
		day: 'numeric',
	});
}
---

<main class="group w-full p-4 md:w-1/2 lg:w-1/3">
	<section
		data-testid="contribution-card"
		class={`relative flex h-28 overflow-hidden rounded-xl bg-white/95 p-2 shadow-lg transition-all duration-300 ease-in-out hover:scale-[1.02] hover:bg-white hover:shadow-xl ${
			isTopContribution
				? 'ring-2 ring-orange ring-offset-2 ring-offset-white dark:ring-offset-gray-900'
				: ''
		}`}
	>
		{
			isTopContribution && (
				<div class="dark:border-gray-900 absolute -top-0 right-2 z-10 inline-flex h-6 w-8 items-center justify-center rounded-full border-2 border-white bg-orange px-4 text-xs font-bold text-black dark:text-white">
					TOP
				</div>
			)
		}

		<article class="relative flex w-10/12 flex-grow flex-col pr-2">
			<!-- Title (Subject of PR/Issue) -->
			<h3
				class="text-md transform font-medium text-black/90 transition-all duration-300 ease-in-out group-hover:translate-y-[-100%] group-hover:opacity-0 lg:text-lg"
			>
				{contribution.title}
			</h3>

			<!-- Repository name (hidden on hover) -->
			<div class="mb-1 transform transition-all duration-300 ease-in-out group-hover:translate-y-[100%] group-hover:opacity-0">
				<span class="text-blue-600 dark:text-blue-600 text-xs font-medium">
					{contribution.repoFullName}
				</span>
			</div>

			<!-- Description on hover -->
			{
				showDescription && contribution.description && (
					<p class="absolute left-2 top-2 w-[85%] translate-y-full transform text-sm text-black/80 opacity-0 transition-all duration-300 ease-in-out group-hover:translate-y-0 group-hover:opacity-100">
						{contribution.description}
					</p>
				)
			}

			<!-- Date, Language, and Tags at bottom -->
			<div class="mb-1 mt-auto">
				<!-- Date and Language row -->
				<div
					class="mb-1 flex transform items-center justify-between transition-all duration-300 ease-in-out group-hover:translate-y-[100%] group-hover:opacity-0"
				>
					{
						contribution.dateCompleted && (
							<span class="text-gray-500 dark:text-gray-600 text-xs">
								{formatDate(contribution.dateCompleted)}
							</span>
						)
					}
					{
						contribution.language && (
							<span class="rounded-full px-2 py-0.5 text-xs font-medium bg-gray-100 text-gray-800">
								{contribution.language}
							</span>
						)
					}
				</div>

				<!-- Tags row -->
				<div
					class="transform transition-all duration-300 ease-in-out group-hover:translate-y-[100%] group-hover:opacity-0"
				>
					<Tags tags={contribution.customLabels || contribution.labels.slice(0, 2)} />
				</div>
			</div>
		</article>

		<!-- Single button for contribution link -->
		<div class="flex w-2/12 flex-col items-center justify-center">
			<a
				href={contribution.url}
				target="_blank"
				rel="noopener noreferrer"
				class="bg-gray-100 text-gray-600 hover:bg-blue-100 hover:text-blue-600 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-blue-900 dark:hover:text-blue-400 flex h-8 w-8 items-center justify-center rounded-full transition-all duration-300"
				title="View Contribution"
			>
				<svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
					<path
						d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"
					></path>
					<path
						d="M5 5a2 2 0 00-2 2v6a2 2 0 002 2h6a2 2 0 002-2v-1a1 1 0 10-2 0v1H5V7h1a1 1 0 000-2H5z"
					></path>
				</svg>
			</a>
		</div>
	</section>
</main>
